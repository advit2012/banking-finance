pipeline {
    agent any
    stages {
        stage('Checkout Code from GitHub') {
            steps {
                git url: 'https://github.com/advit2012/banking-finance/'
                echo 'GitHub URL checked out'
            }
        }
        stage('Code Compile with Manjeet') {
            steps {
                echo 'Starting compilation'
                sh 'mvn compile'
            }
        }
        stage('Code Testing with Manjeet') {
            steps {
                sh 'mvn test'
            }
        }
        stage('QA with Manjeet') {
            steps {
                sh 'mvn checkstyle:checkstyle'
            }
        }
        stage('Package with Manjeet') {
            steps {
                sh 'mvn package'
            }
        }
        stage('Build Docker Image') {
            steps {
                sh 'docker build -t advit2012/banking6aug:1.0 .'
            }
        }
        stage('Login to Docker Hub and Push Image') {
            steps {
                withCredentials([string(credentialsId: 'dockerhubpass', variable: 'DOCKERHUB_PASS')]) {
                    sh 'docker login -u advit2012 -p ${DOCKERHUB_PASS}'
                    sh 'docker push advit2012/banking6aug:1.0'
                }
            }
        }
        stage('Deployment Using Ansible') {
            steps {
                ansiblePlaybook(
                    become: true,
                    credentialsId: 'ansible',
                    disableHostKeyChecking: true,
                    installation: 'ansible',
                    inventory: '/etc/ansible/hosts',
                    playbook: 'ansible-playbook.yml'
                )
            }
        }
    }
}
